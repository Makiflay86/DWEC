<!doctype html>
<html lang="es-ES">
    <head>
        <title>AybarRomero_Francisco_05-13c JS Ajax Premise y await</title>
        <!-- Required meta tags -->
        <meta charset="utf-8" />
        <meta
            name="viewport"
            content="width=device-width, initial-scale=1, shrink-to-fit=no"
        />

        <!-- Bootstrap CSS v5.2.1 -->
        <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
            rel="stylesheet"
            integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN"
            crossorigin="anonymous"
        />
    </head>

    <body>
        
        <div class="container my-5">
            <div class="row justify-content-center">
                <div class="col-12 col-md-8 col-lg-6">

                    <section class="my-3 pt-3 rounded shadow bg-info-subtle">
                        <div class="text-center mb-3">
                            <h1>Ejercicio 1</h1>
                            <hr class="border border-primary w-25 mx-auto">
                        </div>
                        <article class="bg-primary-subtle p-5 rounded">

                            <div id="ej1"></div>

                            <script>
                                let ej1 = document.getElementById("ej1");

                                // Simula cargar artículos recientes (1.5 s)
                                function cargarArticulosRecientes() 
                                {
                                    return new Promise(resolve => {
                                        setTimeout(() => {
                                            resolve("Artículos recientes cargados");
                                        }, 1500);
                                        ej1.innerHTML += "Cargando artículos recientes...<br>";
                                    });
                                }

                                // Simula cargar ventas del mes (2.0 s)
                                function cargarVentasDelMes() 
                                {
                                    return new Promise(resolve => {
                                        setTimeout(() => {
                                            resolve("Ventas del mes cargadas");
                                        }, 2000);
                                        ej1.innerHTML += "Cargando ventas del mes...<br>";
                                    });
                                }

                                // Simula cargar imagen de perfil (0.5 s)
                                function cargarImagenDePerfil() 
                                {
                                    return new Promise(resolve => {
                                        setTimeout(() => {
                                            resolve("Imagen de perfil cargada");
                                        }, 500);
                                        ej1.innerHTML += "Cargando imagen de perfil...<br>";
                                    });
                                }

                                // Función principal usando Promise.all()
                                async function cargarPanelDeControl() 
                                {
                                    ej1.innerHTML += "Cargando panel de control...<br>";

                                    const resultados = await Promise.all([
                                        cargarArticulosRecientes(),
                                        cargarVentasDelMes(),
                                        cargarImagenDePerfil()
                                    ]);

                                    ej1.innerHTML += "Panel cargado:<br>";
                                    for (let i = 0; i < resultados.length; i++) 
                                    {
                                        ej1.innerHTML += `<li>${resultados[i]}`;
                                    }
                                }

                                // Ejecutar
                                cargarPanelDeControl(); 
                            </script>

                        </article>
                    </section>



                    <section class="my-3 pt-3 rounded shadow bg-info-subtle">
                        <div class="text-center mb-3">
                            <h1>Ejercicio 2</h1>
                            <hr class="border border-primary w-25 mx-auto">
                        </div>
                        <article class="bg-primary-subtle p-5 rounded">

                            <div id="ej2"></div>

                            <script>
                                let ej2 = document.getElementById("ej2");

                                // Función que simula la carga de ventas del mes, pero ahora falla
                                function cargarVentasDelMes() 
                                {
                                    return new Promise((resolve, reject) => {
                                        setTimeout(() => {
                                            reject("Error de conexión con la base de datos de ventas");
                                        }, 1000);
                                        ej2.innerHTML += "Cargando ventas del mes...<br>";
                                    });
                                }

                                // Otra función cualquiera del panel (simulación)
                                function cargarUsuariosActivos() 
                                {
                                    return new Promise(resolve => {
                                        setTimeout(() => {
                                            resolve("Usuarios activos cargados");
                                        }, 500);
                                        ej2.innerHTML += "Cargando usuarios activos...<br>";
                                    });
                                }

                                // Función principal que usa Promise.all()
                                async function cargarPanelDeControl() 
                                {
                                    try 
                                    {
                                        let resultados = await Promise.all([
                                            cargarVentasDelMes(),
                                            cargarUsuariosActivos()
                                        ]);

                                        ej2.innerHTML += `Panel cargado: ${resultados}<br>`;

                                    } catch (error) 
                                    {
                                        ej2.innerHTML += `Ocurrió un error: ${error}<br>`;
                                    }
                                }

                                // Ejecutar
                                cargarPanelDeControl();
                            </script>

                        </article>
                    </section>



                    <section class="my-3 pt-3 rounded shadow bg-info-subtle">
                        <div class="text-center mb-3">
                            <h1>Ejercicio 3</h1>
                            <hr class="border border-primary w-25 mx-auto">
                        </div>
                        <article class="bg-primary-subtle p-5 rounded">

                            <div id="ej3"></div>

                            <script>
                                let ej3 = document.getElementById("ej3");

                                // Función que devuelve un token después de 1 segundo
                                async function obtenerToken() 
                                {
                                    return new Promise(resolve => {
                                        setTimeout(() => {
                                            resolve("TOKEN_ABC");
                                        }, 1000);
                                        ej3.innerHTML += "Devolviendo el token...<br>";
                                    });
                                }

                                // Función que recibe el token y devuelve recursos después de 2 segundos
                                async function obtenerRecursos(token) 
                                {
                                    return new Promise(resolve => {
                                        setTimeout(() => {
                                            resolve(`Recursos cargados con token: ${token}`);
                                        }, 2000);
                                        ej3.innerHTML += "Recibiendo el token y devolviendo los recursos...<br>";
                                    });
                                }

                                // Flujo secuencial
                                async function ejecutarFlujo() 
                                {
                                    ej3.innerHTML += "Obteniendo token...<br>";
                                    let token = await obtenerToken();   // Espera 1 segundo
                                    ej3.innerHTML += `Token recibido: ${token}<br>`;


                                    ej3.innerHTML += "Cargando recursos...<br>";
                                    let recursos = await obtenerRecursos(token);  // Espera 2 segundos
                                    ej3.innerHTML += `${recursos}<br>`;
                                }

                                // Ejecutar
                                ejecutarFlujo();

                            </script>

                        </article>
                    </section>

                </div>
            </div>
        </div>
        
        <!-- Bootstrap JavaScript Libraries -->
        <script
            src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"
            integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r"
            crossorigin="anonymous"
        ></script>

        <script
            src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.min.js"
            integrity="sha384-BBtl+eGJRgqQAUMxJ7pMwbEyER4l1g+O15P+16Ep7Q9Q+zqX6gSbd85u4mG4QzX+"
            crossorigin="anonymous"
        ></script>
    </body>
</html>
