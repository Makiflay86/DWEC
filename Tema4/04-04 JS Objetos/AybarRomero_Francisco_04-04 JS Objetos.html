<!doctype html>
<html lang="es-ES">
    <head>
        <title>AybarRomero_Francisco_04-04 JS Objetos</title>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
    </head>

    <body class="container-fluid w-75">
        
        <section class="bg-info-subtle my-5 p-5 border border-info rounded shadow">
            <h1 class="text-center">AybarRomero_Francisco_04-04 JS Objetos</h1>
            
            <article class="bg-white mt-5 p-5 border border-black rounded shadow">
                <h3>Resultados Alumnos e Instituto</h3>
                <div id="ej-display" class="font-monospace"></div>
                <div id="msg"></div> <div id="ej-santa"></div> <script>
                    const display = document.getElementById("ej-display");

                    // --- EJERCICIO 1 y 2: Objeto Alumno con funciones flecha ---
                    function Alumno(nombre, apellidos, id, nombresModulos, notasModulos) {
                        this._nombre = nombre;
                        this._apellidos = apellidos;
                        this._id = id;
                        this._nombresModulos = nombresModulos;
                        this._notasModulos = notasModulos;

                        Object.defineProperties(this, {
                            nombre: { get: () => this._nombre, set: (v) => this._nombre = v },
                            apellidos: { get: () => this._apellidos, set: (v) => this._apellidos = v },
                            id: { get: () => this._id, set: (v) => this._id = v }
                        });

                        this.mostrarModulos = (idDestino) => {
                            document.getElementById(idDestino).innerHTML += `<br>M칩dulos: ${this._nombresModulos.join(", ")}`;
                        };

                        this.nota = (nombreModulo) => {
                            const index = this._nombresModulos.indexOf(nombreModulo);
                            return index !== -1 ? this._notasModulos[index] : "No encontrado";
                        };

                        this.media = (idDestino) => {
                            let suma = this._notasModulos.reduce((a, b) => a + b, 0);
                            let promedio = (suma / this._notasModulos.length).toFixed(2);
                            document.getElementById(idDestino).innerHTML += `<br>Media: ${promedio}`;
                        };

                        this.suspensas = (idDestino) => {
                            let fallidas = this._notasModulos.filter(n => n < 5);
                            document.getElementById(idDestino).innerHTML += `<br>Suspensas: ${fallidas.length > 0 ? fallidas.join(", ") : "Ninguna"}`;
                        };

                        this.aprobadas = (idDestino) => {
                            let ok = this._notasModulos.filter(n => n >= 5);
                            document.getElementById(idDestino).innerHTML += `<br>Aprobadas: ${ok.join(", ")}`;
                        };
                    }

                    // --- EJERCICIO 3: Ejemplo de uso ---
                    const a1 = new Alumno("Francisco", "Aybar", "far", ["DIW", "DWEC", "DWES"], [8, 4, 7]);
                    display.innerHTML = `<strong>Alumno 1:</strong> ${a1.nombre}`;
                    a1.mostrarModulos("ej-display");
                    a1.media("ej-display");
                    a1.suspensas("ej-display");

                    // --- EJERCICIO 4: Objeto Clase ---
                    const Clase = {
                        alumnos: [],
                        matricular: (alu) => Clase.alumnos.push(alu),
                        eliminar: (alu) => Clase.alumnos = Clase.alumnos.filter(a => a.id !== alu.id),
                        numero: () => Clase.alumnos.length,
                        mostrar: (idDestino) => {
                            let nombres = Clase.alumnos.map(a => a.nombre).join(" | ");
                            document.getElementById(idDestino).innerHTML += `<br><strong>Clase:</strong> ${nombres}`;
                        }
                    };
                    Clase.matricular(a1);
                    Clase.mostrar("ej-display");

                    // --- EJERCICIO 5, 6 y 7: Instituto ---
                    const instituto = {
                        nombre: "IES PLAYAMAR",
                        direccion: "Rda. Alta de Benyamina, 17, 29620 Torremolinos, M치laga",
                        id: "inst-01",
                        // Ej 6: An칩nima
                        cambiarNombre: function(nueva) { this.direccion = nueva; },
                        // Ej 7: Flecha
                        mostrar: (idDestino) => {
                            document.getElementById(idDestino).innerHTML += `<br><strong>Inst:</strong> ${instituto.nombre} (${instituto.direccion})`;
                        }
                    };
                    instituto.mostrar("ej-display");

                    // --- EJERCICIO 8: Contexto de 'this' ---
                    window.age = 10;
                    function Person1() {
                        this.age = 41;
                        setTimeout(function () { 
                            document.getElementById('msg').innerHTML += "<br>Anon. this.age: " + this.age; // 10 (Window)
                        }, 100); 
                    }
                    function Person2() {
                        this.age = 42;
                        setTimeout(() => { 
                            document.getElementById('msg').innerHTML += "<br>Flecha this.age: " + this.age; // 42 (Person2)
                        }, 100); 
                    }
                    new Person1();
                    new Person2();

                    // --- EJERCICIO 9: Prototype din치mico ---
                    Alumno.prototype.saludar = function() { return `Hola, soy ${this._nombre}`; };
                    display.innerHTML += `<br>${a1.saludar()}`;

                    // --- EJERCICIO 10: Santa Claus ---
                    function organizeInventory(inventory) {
                        return inventory.reduce((acc, { name, quantity, category }) => {
                            if (!acc[category]) acc[category] = {};
                            acc[category][name] = (acc[category][name] || 0) + quantity;
                            return acc;
                        }, {});
                    }

                    const inventory = [
                        { name: 'doll', quantity: 5, category: 'toys' },
                        { name: 'car', quantity: 3, category: 'toys' },
                        { name: 'ball', quantity: 2, category: 'sports' },
                        { name: 'car', quantity: 2, category: 'toys' },
                        { name: 'racket', quantity: 11, category: 'sports' }
                    ];

                    const resSanta = organizeInventory(inventory);
                    document.getElementById("ej-santa").innerHTML = `<hr><strong>Inventario Santa:</strong><pre>${JSON.stringify(resSanta, null, 2)}</pre>`;
                </script>
            </article>
        </section>

        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.min.js"></script>
    </body>
</html>